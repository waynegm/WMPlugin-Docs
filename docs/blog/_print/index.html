<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.124.1">
<link rel="canonical" type="text/html" href="https://waynegm.github.io/WMPlugin-Docs/blog/">
<link rel="alternate" type="application/rss&#43;xml" href="https://waynegm.github.io/WMPlugin-Docs/blog/index.xml">
<meta name="robots" content="noindex, nofollow">


<link rel="shortcut icon" href="/WMPlugin-Docs/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/WMPlugin-Docs/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/WMPlugin-Docs/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/WMPlugin-Docs/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/WMPlugin-Docs/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/WMPlugin-Docs/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/WMPlugin-Docs/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/WMPlugin-Docs/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/WMPlugin-Docs/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/WMPlugin-Docs/favicons/android-192x192.png" sizes="192x192">

<title>WMPlugins Blog | WMPlugins</title>
<meta name="description" content="This is the blog section. It has two categories: News and Releases.
Files in these directories will be listed in reverse chronological order.
">
<meta property="og:title" content="WMPlugins Blog" />
<meta property="og:description" content="Documentation for my open source plugins to the OpendTect seismic interpretation system" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://waynegm.github.io/WMPlugin-Docs/blog/" /><meta property="og:site_name" content="WMPlugins" />
<meta itemprop="name" content="WMPlugins Blog">
<meta itemprop="description" content="Documentation for my open source plugins to the OpendTect seismic interpretation system"><meta name="twitter:card" content="summary"/><meta name="twitter:title" content="WMPlugins Blog"/>
<meta name="twitter:description" content="Documentation for my open source plugins to the OpendTect seismic interpretation system"/>




<link rel="preload" href="/WMPlugin-Docs/scss/main.min.89300008cc31a5e13d36bfdb093b10fd4fcc4d3c8ff708f3f9128af3884f69d3.css" as="style">
<link href="/WMPlugin-Docs/scss/main.min.89300008cc31a5e13d36bfdb093b10fd4fcc4d3c8ff708f3f9128af3884f69d3.css" rel="stylesheet" integrity="">

<script
  src="https://code.jquery.com/jquery-3.6.0.min.js"
  integrity="sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK"
  crossorigin="anonymous"></script>
<script
  src="https://unpkg.com/lunr@2.3.9/lunr.min.js"
  integrity="sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli"
  crossorigin="anonymous"></script>


<link rel="stylesheet" href="/WMPlugin-Docs/css/juxtapose.css"/>

<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-62607269-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  </head>
  <body class="td-section td-blog">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
        <a class="navbar-brand" href="/WMPlugin-Docs/">
		<span class="navbar-logo"><svg width="30" height="29.990032" id="svg2" inkscape:version="1.1.2 (0a00cf5339, 2022-02-04, custom)" inkscape:export-filename="test.png" inkscape:export-xdpi="100" inkscape:export-ydpi="100" sodipodi:docname="logo.svg" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/"><defs id="defs4"><clipPath clipPathUnits="userSpaceOnUse" id="clipPath3861"><rect style="fill:none;stroke:maroon;stroke-width:.313602;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:0;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" id="rect3863" width="77.660332" height="77.853149" x="310.03735" y="224.89983" rx=".50646973" ry=".50646973"/></clipPath></defs><sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1" inkscape:pageopacity="1" inkscape:pageshadow="2" inkscape:zoom="5.7415178" inkscape:cx="14.543193" inkscape:cy="45.893788" inkscape:document-units="px" inkscape:current-layer="layer1" showgrid="false" inkscape:window-width="1542" inkscape:window-height="836" inkscape:window-x="884" inkscape:window-y="151" inkscape:window-maximized="0" inkscape:pagecheckerboard="0" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" showborder="true"/><g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(-309.40455,-224.50644)"><rect style="fill:#fff;stroke:none;stroke-width:1.08" id="rect308" width="30" height="30" x="309.40454" y="224.50644"/><g id="g106" transform="matrix(0.38121346,0,0,0.38121346,191.45537,138.92156)"><text style="font-style:normal;font-weight:400;line-height:0%;font-family:bitstream vera sans;letter-spacing:0;word-spacing:0;fill:#000;fill-opacity:1;stroke:none" x="313.37061" y="291.67529" id="text3050"><tspan sodipodi:role="line" id="tspan3052" x="313.37061" y="291.67529" style="font-size:11px;line-height:1.25"> </tspan></text><path style="fill:maroon;stroke:maroon;stroke-width:0;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="m387.4512 242.23695s0-.12316-5.54206-.12316-24.01557 2.33998-24.75451 25.98608c-.73894 23.6461 17.48826 25.3703 21.79875 25.24714 4.31049-.12316 8.74413.0 8.74413.0l-.12316 4.92627s-.98525 1.10841-8.37465.98526c-7.38941-.12316-26.47871-4.80311-26.60187-30.54288-.12316-25.73977 23.52295-32.63655 29.065-32.39023s5.91152.36947 5.91152.36947z" id="path3853" inkscape:connector-curvature="0" sodipodi:nodetypes="czzzcczzzcc"/><path style="fill:maroon;stroke:maroon;stroke-width:.4;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="m362.943 266.00621c.224-12.51095 9.42012-17.08677 16.62616-17.11879 7.20604-.032 8.00519 2.70944 8.00519 2.70944l-.24631 7.26625s-3.31403-4.8874-9.1136-4.92627c-5.79957-.0389-10.90531 5.75542-10.8378 12.43884.0675 6.68342 4.37668 13.20715 9.85255 13.54724s10.34516-5.4189 10.34516-5.4189l-.12315 8.12835s-2.99852 2.97549-9.48307 2.95576c-6.48455-.0197-15.24913-7.07097-15.02513-19.58192z" id="path3855" inkscape:connector-curvature="0" sodipodi:nodetypes="zzcczzzcczz"/><path sodipodi:type="arc" style="fill:none;stroke:none" id="path3065" sodipodi:cx="377.86176" sodipodi:cy="266.76852" sodipodi:rx="2.8738046" sodipodi:ry="4.4413342" d="m380.73556 266.76852a2.8738046 4.4413342.0 01-2.87041 4.44134 2.8738046 4.4413342.0 01-2.87719-4.43084 2.8738046 4.4413342.0 012.86361-4.4518 2.8738046 4.4413342.0 012.88396 4.42032" sodipodi:start="0" sodipodi:end="6.2784611" sodipodi:open="true" sodipodi:arc-type="arc"/><path style="fill:maroon;stroke:maroon;stroke-width:.2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="m343.23792 268.22303c-.0259-6.55971 2.48565-13.87236 4.43365-18.2272 1.94799-4.35485 5.78836-10.8378 10.83779-15.76407 5.04943-4.92627 11.45358-9.9757 21.79875-9.60623 10.34516.36947 7.26624.36947 7.26624.36947l-.12315 4.31049s.87575-.27087-6.89678-.24631c-7.77253.0246-17.48827 5.17258-22.29138 11.20726-4.80311 6.03468-10.93423 17.70247-10.71464 26.72502.21959 9.02254.98526 17.73457 6.03469 24.75451 6.81828 9.47906 10.71464 11.33042 10.71464 11.33042s-6.76189-.17021-7.26626-.12316c-3.33696-2.9087-7.50492-8.85484-9.48307-13.05461-1.97815-4.19977-4.28454-15.11588-4.31048-21.67559z" id="path3083" inkscape:connector-curvature="0" sodipodi:nodetypes="zzzscczzzscczz"/><path style="fill:none;stroke:#000;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" d="m336.32222 244.2135 40.92994 21.24874h-.17417v0" id="path3069" inkscape:connector-curvature="0"/><path style="fill:none;stroke:#000;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" d="m320.29858 259.54046 56.08273 7.83765v0" id="path3071" inkscape:connector-curvature="0"/><path style="fill:none;stroke:#000;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" d="m339.80562 274.34491 36.92403-5.74761" id="path3073" inkscape:connector-curvature="0"/><path style="fill:maroon;stroke:#000;stroke-width:.4;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="m336.67056 244.56184-4.70259.34834-13.75943-6.44429 5.39927-1.56753-1.04502-5.2251 13.75943 8.36016z" id="path3075" inkscape:connector-curvature="0"/><path style="fill:maroon;stroke:#000;stroke-width:.4;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="m322.56279 280.44086h11.32105l6.9668-6.09595-5.57344-2.61255-14.97862.34834 4.87676 3.83174z" id="path3077" inkscape:connector-curvature="0"/><path style="fill:maroon;stroke:#000;stroke-width:.4;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="m309.98559 262.06519 6.03468-.49263 4.67996-2.09366-2.83261-3.81786-8.2515-3.32523z" id="path3081" inkscape:connector-curvature="0"/></g></g></svg></span><span class="font-weight-bold">WMPlugins</span>
	</a>
	<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
		<ul class="navbar-nav mt-2 mt-lg-0">
			
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/WMPlugin-Docs/about/" ><span>About</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/WMPlugin-Docs/docs/" ><span>Documentation</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link active" href="/WMPlugin-Docs/blog/" ><span class="active">Blog</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/WMPlugin-Docs/community/" ><span>Community</span></a>
			</li>
			
			
			
			<li><a class="btn btn-sm btn-secondary mr-4 nav-link" href="https://ko-fi.com/N4N6CFI7R" target="blank" >
			    Support WMPlugins Development <i class="fas fa-arrow-alt-circle-right ml-2"></i></a>
			</li>
		</ul>
	</div>
	<div class="navbar-nav d-none d-lg-block"><input
  type="search"
  class="form-control td-search-input"
  placeholder="&#xf002; Search this site…"
  aria-label="Search this site…"
  autocomplete="off"
  
  data-offline-search-index-json-src="/WMPlugin-Docs/offline-search-index.9051fd93a1c6657d10c2214de60fe9f7.json"
  data-offline-search-base-href="/"
  data-offline-search-max-results="10"
>
</div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
          </div>
          <div class="d-none d-xl-block col-xl-2 td-toc d-print-none">
          </div>
          <main class="col-12 col-md-9 col-xl-8 pl-md-5 pr-md-4" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
This is the multi-page printable view of this section.
<a href="#" onclick="print();return false;">Click here to print</a>.
</p><p>
<a href="/WMPlugin-Docs/blog/">Return to the regular view of this page</a>.
</p>
</div>



<h1 class="title">WMPlugins Blog</h1>





    <ul>
    
  
  
  
  

  
    
    
	

    <li><a href="#pg-892aef332ac924a09cf07fdf11e30d42">WMPlugins 6.6.10 Release</a></li>



    
  
    
    
	

    <li><a href="#pg-4d5f23ec3378acf731f2e97a9cfdd172">First Release of Python Bindings to OpendTect</a></li>



    
  
    
    
	

    <li><a href="#pg-e98ab01024faca470778e7963fd26150">Seismic Modelling and Inversion using PyLops based Python External Attributes</a></li>



    
  
    
    
	

    <li><a href="#pg-88e57065252962c8a33e9809541bb03f">Using Visual Studio Code with OpendTect</a></li>



    
  
    
    
	

    <li><a href="#pg-48928b295051258867c91340ec92d098">GPU vs CPU Benchmarks for OpendTect Attribute Plugins</a></li>



    
  
    
    
	

    <li><a href="#pg-68d9691ed6354001f04dcafce131c82e">Python External Attribute Tips &amp; Tricks - Debugging</a></li>



    
  
    
    
	

    <li><a href="#pg-21f5150dff687604c8c9d21da0990e6c">Python External Attribute Tips &amp; Tricks - Logging</a></li>



    
  
    
    
	

    <li><a href="#pg-df07e6c0c5aba733a97e8142e3fc5203">Anatomy of a Python External Attribute</a></li>



    
  

    </ul>


<div class="content">
      <p>This is the <strong>blog</strong> section. It has two categories: News and Releases.</p>
<p>Files in these directories will be listed in reverse chronological order.</p>

</div>
</div>


  
  
  
  

  
  

  
    
    
	
    


  

<div class="td-content" style="">
    <h1 id="pg-892aef332ac924a09cf07fdf11e30d42">WMPlugins 6.6.10 Release</h1>
	
	<div class="td-byline mb-4">
		
        
		<time datetime="2022-04-15" class="text-muted">Friday, April 15, 2022</time>
        
	</div>
	<p>Announcing the release of version 6.6.10 of the <a href="https://waynegm.github.io/WMPlugin-Docs/">WMPlugins</a> a suite of opensource plugins that extend the opensource seismic interpretation
system <a href="https://dgbes.com/index.php/software#free">OpendTect</a>. This release is built against OpendTect 6.6.7.</p>
<p>The release includes the following changes:</p>
<h2 id="avopolarattrib">AVOPolarAttrib</h2>
<p>Nans and Infs generated during the calculation of the attributes are converted to OpendTect Undefined, fixing a crash.</p>
<h2 id="efdattrib">EFDAttrib</h2>
<p>Two new attributes have been added that use <a href="https://arxiv.org/abs/1912.00414">Empirical Fourier Decomposition (Zhou etal(2019)</a>. The
two attributes generate the mode decomposition and a spectral decomposition from the mode decomposition. These provide a signal analysis
akin to Empirical Mode Decomposition. A subsequent post will look at these new attributes in detail and compare the new spectral
decomposition option with the existing WMPlugin tools such as Recursive spectral decomposition and Spectral decomposition by local attribute.</p>

<figure class="img-centered">
    <img src="/WMPlugin-Docs/blog/2022/04/15/wmplugins-6.6.10-release/image-01.png"
         alt="Empirical Fourier Mode/Spectral Decomposition" width="90%"/> <figcaption>
            <p><strong>Empirical Fourier Mode/Spectral Decomposition</strong></p>
        </figcaption>
</figure>

<h2 id="external-attributes">External attributes</h2>
<p>This release fixes a crash when loading an attribute set with either a non-existent python interpreter or attribute script and now
reports syntax errors from the script when building the UI via a UI message box. Previously these errors were recorded in the OpendTect
log file but the user did not get any direct feedback that an issue was encountered.</p>

<figure class="img-centered">
    <img src="/WMPlugin-Docs/blog/2022/04/15/wmplugins-6.6.10-release/image-03.png"
         alt="Improved error reporting in the External Attribute plugin" width="90%"/> <figcaption>
            <p><strong>Improved error reporting in the External Attribute plugin</strong></p>
        </figcaption>
</figure>

<p>Also fixed various issues with the included wmpy scripts to make them compatible with the versions of Python modules installed by the OpendTect
installation manager.</p>
<h2 id="mistie-analysis">Mistie Analysis</h2>
<p>Fixed a crash when estimating misties for depth surveys.</p>
<h2 id="wmodpy---opendtect-python-bindings">wmodpy - OpendTect Python Bindings</h2>
<p>A decision was made to discontinue development of these within WMPlugins in favour of moving the code
into the dGB managed OpendTect open source code repository system on Github. The new repository will be
called &ldquo;odpybind&rdquo;.</p>
</div>





    
	
  
    
    
	
    


  

<div class="td-content" style="page-break-before: always">
    <h1 id="pg-4d5f23ec3378acf731f2e97a9cfdd172">First Release of Python Bindings to OpendTect</h1>
	
	<div class="td-byline mb-4">
		
        
		<time datetime="2021-06-29" class="text-muted">Tuesday, June 29, 2021</time>
        
	</div>
	<p>The 6.6.8 release of the <a href="https://waynegm.github.io/WMPlugin-Docs/">WMPlugins</a> includes a Python module, <strong>wmodpy</strong>, to access OpendTect survey and well information. Unlike
OpendTect&rsquo;s existing <strong>odpy</strong> module, <strong>wmodpy</strong> is a direct binding to the OpendTect C++ code.</p>
<p>The <strong>odpy</strong> module, by comparison, uses a command line application to interact with the OpendTect data structures and transfers
data to Python as an ascii data stream. This incurs the overhead of starting this application and the writing and reading of an
ascii data stream on every request. The <strong>wmodpy</strong> module, however, as a direct binding to the OpendTect C++ code allows Python
to directly read from the in-memory representation of the data. Data access with the <strong>wmodpy</strong> module should be much faster.</p>
<h2 id="accessing-the-wmodpy-module">Accessing the wmodpy Module</h2>
<p>Installing my <strong>WMPlugins</strong> using the OpendTect installation manager will install the <strong>wmodpy</strong> Python module into the <em>bin/win64/Release</em>
or <em>bin/lux64/Release</em> subfolder of the OpendTect software. You also need a Python environment with at least Numpy but additional
output options exist if the environment also has Pandas. The OpendTect machine learning Python environments already include Numpy
and Pandas. For map display you may want to add a module like Folium to your working environment.</p>
<p>The folder containing the bindings library must be on the PYTHONPATH to be found by an import statement in a Python script or notebook.
You can either use the OpendTect Python Settings dialog (accessible from the Utilities| Installation|Python Settings application menu)
and add the location of the OpendTect executable files to the Custom Module Path or modify the PYTHONPATH within the script.</p>

<figure class="img-centered">
    <img src="/WMPlugin-Docs/blog/2021/06/29/first-release-of-python-bindings-to-opendtect/image-02.png"
         alt="OpendTect Python Settings Dialog" width="90%"/> <figcaption>
            <p><strong>OpendTect Python Settings Dialog</strong></p>
        </figcaption>
</figure>

<p>The OpendTect Python Settings dialog also allows you to select a custom Python environment to use and also add an icon to the OpendTect
toolbar to start your chosen IDE and console (only OpendTect 6.6.4) with the specified custom Python environment activated and the
Custom Module Paths added to the PYTHONPATH.</p>
<p>The alternative script/notebook  based solution requires something like the following at the top of the script:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">sys</span>
</span></span><span style="display:flex;"><span><span style="color:#000">sys</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">path</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">insert</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;C:/Program Files/OpendTect/6.6.0/bin/win64/Release&#39;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">wmodpy</span>
</span></span></code></pre></div><h2 id="general-survey-information">General Survey Information</h2>
<p>The module includes a number of functions for getting information about OpendTect surveys/projects. These all require
an OpendTect data root folder for context.</p>





<div class="container"> <table class="table table-striped table-bordered">
<thead>
<tr>
<th>Command</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>get_surveys(data_root:str)</td>
<td>Return list of survey names in the given data_root</td>
</tr>
<tr>
<td>get_survey_info(data_root:str, surveys:list)</td>
<td>Return a Python dictionary with basic information for the surveys in the given list or all surveys if no list is given</td>
</tr>
<tr>
<td>get_survey_info_df(data_root:str, surveys:list)</td>
<td>Return a Pandas Dataframe with basic information for the surveys in the given list or all surveys if no list is given</td>
</tr>
<tr>
<td>get_survey_features(data_root:str, surveys:list)</td>
<td>Return a GeoJSON Feature Collection with basic information for the surveys in the given list or all surveys if no list is given</td>
</tr>
</tbody>
</table>
 </div>

<p>Some examples:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000">wmodpy</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">get_surveys</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;/mnt/Data/seismic/CooperBasin/ODData&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;13CP06_Dundinna&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;Cooper2D&#39;</span><span style="color:#000;font-weight:bold">]</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000">wmodpy</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">get_surveys_df</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;/mnt/Data/seismic/ODData&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;F3_Demo_2020&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;Penobscot&#34;</span><span style="color:#000;font-weight:bold">])</span>
</span></span></code></pre></div>
<figure class="img-centered">
    <img src="/WMPlugin-Docs/blog/2021/06/29/first-release-of-python-bindings-to-opendtect/image-03.png"
         alt="Displaying OpendTect survey info in a Pandas Dataframe" width="100%"/> <figcaption>
            <p><strong>Displaying OpendTect survey info in a Pandas Dataframe</strong></p>
        </figcaption>
</figure>


<figure class="img-centered">
    <img src="/WMPlugin-Docs/blog/2021/06/29/first-release-of-python-bindings-to-opendtect/image-01.png"
         alt="Displaying OpendTect survey locations on a Folium web map" width="100%"/> <figcaption>
            <p><strong>Displaying OpendTect survey locations on a Folium web map</strong></p>
        </figcaption>
</figure>

<h2 id="survey-class">Survey Class</h2>
<p>The module adds a <em>Survey</em> Python class. Create a <em>Survey</em> object for a particular data_root and survey_name combination like this:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000">f3demo</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">wmodpy</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Survey</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;/mnt/Data/seismic/ODData&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;F3_Demo_2020&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p>The <em>Survey</em> object can then be used to get information about the survey:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000">f3demo</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">info</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#39;Name&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;F3 Demo 2020&#39;</span><span style="color:#000;font-weight:bold">],</span> <span style="color:#4e9a06">&#39;Type&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;2D3D&#39;</span><span style="color:#000;font-weight:bold">],</span> <span style="color:#4e9a06">&#39;crs&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;EPSG:23031&#39;</span><span style="color:#000;font-weight:bold">]}</span>
</span></span></code></pre></div><p>To get a full list of methods provided by the <em>Survey</em> class use :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000">help</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">wmodpy</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Survey</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p>The other classes added by the module generally require a <em>Survey</em> object for context.</p>
<h2 id="wells-class">Wells Class</h2>
<p>The <em>Wells</em> Python class provides methods to access OpendTect well data within a survey. Creating a <em>Wells</em> object requires a
<em>Survey</em> object for context:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000">f3demo_wells</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">wmodpy</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Wells</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">f3demo</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p>Methods are provided to:</p>
<ul>
<li>List the names of all wells in the project/survey</li>
<li>List summary information on all wells</li>
<li>List well log information in a well</li>
<li>List well log data</li>
<li>List markers in a well</li>
<li>List a well track</li>
</ul>
<p>There is also a &ldquo;features&rdquo; method that returns a GeoJSON Feature Collection. To get a full list of methods provided by
the <em>Wells</em> class use:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000">help</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">wmodpy</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Wells</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p>You will notice that in many cases the same data can be obtained as either a Python dictionary or as a Pandas Dataframe. Methods
returning a Pandas Dataframe have a suffix of &ldquo;_df&rdquo;.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000">f3demo_wells</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">info</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#39;Name&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;F02-1&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;F03-2&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;F03-4&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;F06-1&#39;</span><span style="color:#000;font-weight:bold">],</span>
</span></span><span style="display:flex;"><span> <span style="color:#4e9a06">&#39;UWID&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;&#39;</span><span style="color:#000;font-weight:bold">],</span>
</span></span><span style="display:flex;"><span> <span style="color:#4e9a06">&#39;State&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;&#39;</span><span style="color:#000;font-weight:bold">],</span>
</span></span><span style="display:flex;"><span> <span style="color:#4e9a06">&#39;County&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;&#39;</span><span style="color:#000;font-weight:bold">],</span>
</span></span><span style="display:flex;"><span> <span style="color:#4e9a06">&#39;WellType&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;none&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;none&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;none&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;none&#39;</span><span style="color:#000;font-weight:bold">],</span>
</span></span><span style="display:flex;"><span> <span style="color:#4e9a06">&#39;X&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">606554.0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">619101.0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">623255.98</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">607903.0</span><span style="color:#000;font-weight:bold">],</span>
</span></span><span style="display:flex;"><span> <span style="color:#4e9a06">&#39;Y&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">6080126.0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">6089491.0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">6082586.87</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">6077213.0</span><span style="color:#000;font-weight:bold">],</span>
</span></span><span style="display:flex;"><span> <span style="color:#4e9a06">&#39;ReplacementVelocity&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">2000.0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">2000.0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">2000.0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">2000.0</span><span style="color:#000;font-weight:bold">],</span>
</span></span><span style="display:flex;"><span> <span style="color:#4e9a06">&#39;GroundElevation&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">1.0000000150474662e+30</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#0000cf;font-weight:bold">1.0000000150474662e+30</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#0000cf;font-weight:bold">1.0000000150474662e+30</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#0000cf;font-weight:bold">1.0000000150474662e+30</span><span style="color:#000;font-weight:bold">]}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000">f3demo_wells</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">info_df</span><span style="color:#000;font-weight:bold">()</span>
</span></span></code></pre></div>
<figure class="img-centered">
    <img src="/WMPlugin-Docs/blog/2021/06/29/first-release-of-python-bindings-to-opendtect/image-04.png"
         alt="Displaying OpendTect well info in a Pandas Dataframe" width="100%"/> <figcaption>
            <p><strong>Displaying OpendTect well info in a Pandas Dataframe</strong></p>
        </figcaption>
</figure>

<p>Getting well log data in a Pandas Dataframe is as easy as:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000">f3demo_wells</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">log_data_df</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;F02-1&#39;</span><span style="color:#000;font-weight:bold">,[</span><span style="color:#4e9a06">&#39;Vp&#39;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#4e9a06">&#39;Sonic&#39;</span><span style="color:#000;font-weight:bold">],</span><span style="color:#0000cf;font-weight:bold">0.15</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">wmodpy</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Wells</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">SampleMode</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Upscale</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div>
<figure class="img-centered">
    <img src="/WMPlugin-Docs/blog/2021/06/29/first-release-of-python-bindings-to-opendtect/image-05.png"
         alt="Displaying OpendTect well logs in a Pandas Dataframe" width="100%"/> <figcaption>
            <p><strong>Displaying OpendTect well logs in a Pandas Dataframe</strong></p>
        </figcaption>
</figure>
</div>





    
	
  
    
    
	
    


  

<div class="td-content" style="page-break-before: always">
    <h1 id="pg-e98ab01024faca470778e7963fd26150">Seismic Modelling and Inversion using PyLops based Python External Attributes</h1>
	
	<div class="td-byline mb-4">
		
        
		<time datetime="2021-06-26" class="text-muted">Saturday, June 26, 2021</time>
        
	</div>
	<p>The 6.6.8 release of the <a href="https://waynegm.github.io/WMPlugin-Docs/">WMPlugins</a> includes a number of new Python external attribute scripts that use the
<a href="https://pylops.readthedocs.io/en/latest/">PyLops</a> linear operator library for seismic modelling and inversion.
These scripts also demonstrate the use of the new user interface parameter elements introduced in the 6.6.8 release
of the External Attribute plugin.</p>
<p>Assuming wmPlugins is installed using the OpendTect Installation Manager, the scripts will be in the
<em>bin/python/wmpy/PyLops</em> folder of the OpendTect software folder and include:</p>
<ul>
<li>PyLops/ex_poststack_inversion.py</li>
<li>PyLops/ex_poststack_relative_inversion.py</li>
<li>PyLops/ex_poststack_modelling.py</li>
<li>PyLops/ex_prestack_modelling.py</li>
<li>PyLops/ex_make_1d_seismic.py</li>
</ul>
<p>Using these scripts requires a Python environment with the PyLops python module and it&rsquo;s dependencies installed.
The section <a href="#installing-pylops">Installing PyLops</a> describes the PyLops installation process. Note
that a PyLops python environment includes all the modules required to run any attribute script included with the
<strong>WMPlugins</strong> not just those in the PyLops folder.</p>
<h2 id="post-stack--seismic-inversion">Post-Stack  Seismic Inversion</h2>

<figure class="img-centered">
    <img src="/WMPlugin-Docs/blog/2021/06/26/seismic-modelling-and-inversion-using-pylops-based-python-external-attributes/image-01.png" width="90%"/> 
</figure>

<p>The PyLops/ex_poststack_inversion.py script uses the pylops.avo.poststack.PoststackInversion operator to do
post-stack seismic inversion. The output is either the log Acoustic Impedance (AI) volume or the residual error.</p>
<p>The inputs required are volumes of the seismic to be inverted, a background log AI model and the seismic wavelet.
Note that the polarity of the seismic wavelet must match the data.</p>
<p>The following figures show inversion input and output for a 1D model created by the PyLops/ex_make_1d_seismic.py script.</p>
<p>
<figure class="img-centered">
    <img src="/WMPlugin-Docs/blog/2021/06/26/seismic-modelling-and-inversion-using-pylops-based-python-external-attributes/image-02.png"
         alt="Impedance Model (red) and Background Model (blue)" width="100%"/> <figcaption>
            <p><strong>Impedance Model (red) and Background Model (blue)</strong></p>
        </figcaption>
</figure>


<figure class="img-centered">
    <img src="/WMPlugin-Docs/blog/2021/06/26/seismic-modelling-and-inversion-using-pylops-based-python-external-attributes/image-03.png"
         alt="Impedance Model (red) and Seismic Model (blue)" width="100%"/> <figcaption>
            <p><strong>Impedance Model (red) and Seismic Model (blue)</strong></p>
        </figcaption>
</figure>


<figure class="img-centered">
    <img src="/WMPlugin-Docs/blog/2021/06/26/seismic-modelling-and-inversion-using-pylops-based-python-external-attributes/image-04.png"
         alt="Impedance Model (red) and Inverted Impedance (blue)" width="100%"/> <figcaption>
            <p><strong>Impedance Model (red) and Inverted Impedance (blue)</strong></p>
        </figcaption>
</figure>
</p>
<p>There is also a PyLops/ex_poststack_relative_inversion.py script that runs the inversion without a background model:

<figure class="img-centered">
    <img src="/WMPlugin-Docs/blog/2021/06/26/seismic-modelling-and-inversion-using-pylops-based-python-external-attributes/image-05.png"
         alt="Impedance Model (red) and Inverted Relative Impedance (blue)" width="100%"/> <figcaption>
            <p><strong>Impedance Model (red) and Inverted Relative Impedance (blue)</strong></p>
        </figcaption>
</figure>
</p>

<figure class="img-centered">
    <img src="/WMPlugin-Docs/blog/2021/06/26/seismic-modelling-and-inversion-using-pylops-based-python-external-attributes/image-07.png"
         alt="Inverted Relative Impedance Example" width="100%"/> <figcaption>
            <p><strong>Inverted Relative Impedance Example</strong></p>
        </figcaption>
</figure>

<h2 id="prestack-modelling">Prestack Modelling</h2>

<figure class="img-centered">
    <img src="/WMPlugin-Docs/blog/2021/06/26/seismic-modelling-and-inversion-using-pylops-based-python-external-attributes/image-06.png" width="90%"/> 
</figure>

<p>The PyLops/ex_prestack_modelling.py script uses the pylops.avo.avo.AVOLinearModelling operator to create a
pre-stack angle volume from well data. The output is either an Aki-Richards or Fatti approximate reflectivity
model filtered by a user specified wavelet.</p>
<p>The inputs required are 3 log data cubes with compressional sonic (DT in us/m), shear sonic (DTS in us/m) and
density (RHOB in g/cc). These can be created from well log data using the &ldquo;Create Log Cube&rdquo; right mouse button
context menu in the scene well tree or the &ldquo;Processing|Create Seismic Output|From Well Logs&rdquo; main menu. Also
needed is a wavelet with the appropriate polarity for the data being modelled.</p>
<p>The generated synthetics can be displayed in the 3D window and compared with real angle stack data through the
well location.

<figure class="img-centered">
    <img src="/WMPlugin-Docs/blog/2021/06/26/seismic-modelling-and-inversion-using-pylops-based-python-external-attributes/image-02.jpg" width="100%"/> 
</figure>
</p>
<h2 id="installing-pylops">Installing PyLops</h2>
<p>The PyLops Python package and it&rsquo;s dependencies can be installed in an active conda environment using:</p>
<pre tabindex="0"><code>conda install -c conda-forge pylops
</code></pre><p>or</p>
<pre tabindex="0"><code>pip install pylops
</code></pre><p>See the <a href="https://pylops.readthedocs.io/en/latest/installation.html">PyLops documentation</a> for more information.</p>
</div>





    
	
  
    
    
	
    


  

<div class="td-content" style="page-break-before: always">
    <h1 id="pg-88e57065252962c8a33e9809541bb03f">Using Visual Studio Code with OpendTect</h1>
	
	<div class="td-byline mb-4">
		
        
		<time datetime="2021-06-05" class="text-muted">Saturday, June 05, 2021</time>
        
	</div>
	<p>In this post I show you how to set up and use the free <a href="https://code.visualstudio.com/">Visual Studio Code</a> editor with OpendTect for interactive
computation using Python Jupyter Notebooks. If you have installed the OpendTect Machine Learning Python environments you can
create and edit Python Jupyter Notebooks using Visual Studio Code without modifying the installed environment provided VS Code is run from within
OpendTect. The approach described in this post might assist users in strictly controlled IT settings get up and running using Jupyter Notebooks.</p>
<h2 id="installing-visual-studio-code">Installing Visual Studio Code</h2>
<p>VS Code should be available in the package repositories of all the major Linux distributions so just install it like you would
any other application. Alternatively the <a href="https://code.visualstudio.com/Download">VS Code Download</a> page provides a tar.gz download
for 64 bit Linux that can be copied into a users home folder for those situations where IT settings prevent a global software install.</p>
<p>For Windows go to the <a href="https://code.visualstudio.com/Download">VS Code Download</a> page and download the package of choice. There are 3 options:</p>
<ul>
<li>User installer (software ends up in &ldquo;C:\users{username}\AppData\Local\Programs\Microsoft VS Code&rdquo;, recommended way)</li>
<li>System installer (software ends up in &ldquo;C:\Program Files&rdquo;, requires Administrator privileges)</li>
<li>.zip (you unpack the zip file anywhere even on a usb stick)</li>
</ul>
<p>Once installed, start it up (find the executable file call &ldquo;code&rdquo; in the application folder and run it from a console or click/double click
on it from your file manager/explorer) and add the following extensions:</p>
<ul>
<li>Python extension for Visual Studio Code</li>
<li>Jupyter Extension for Visual Studio Code</li>
</ul>
<h2 id="selecting-visual-studio-code-as-the-opendtect-ide">Selecting Visual Studio Code as the OpendTect IDE</h2>
<p>Open the OpendTect Python Settings dialog (Utilities|Installation|Python Settings menu)

<figure class="img-centered">
    <img src="/WMPlugin-Docs/blog/2021/06/05/using-visual-studio-code-with-opendtect/image-02.png"
         alt="OpendTect Python Settings Dialog" width="90%"/> <figcaption>
            <p><strong>OpendTect Python Settings Dialog</strong></p>
        </figcaption>
</figure>
</p>
<ol>
<li>For the Python IDE select &ldquo;Other&rdquo;</li>
<li>Use the File Selector to locate the executable file called &ldquo;code&rdquo; in the VS Code application folder</li>
<li>Use the icon button to set the location of an icon for the application (normally in the resources/app/resources/(linux|win32) subfolder
of the VS Code installation)</li>
<li>Set a tooltip message, eg &ldquo;VS Code&rdquo;</li>
<li>Press OK</li>
</ol>
<p>This will add an icon to the OpendTect toolbar and a new menu item to the &ldquo;Utilities|User Commands&rdquo; menu to start Visual Studio Code. Starting
VS Code from within OpendTect ensures environment settings are compatible with the Python environment selected in the OpendTect Python
Settings dialog.</p>
<p>
<figure class="img-centered">
    <img src="/WMPlugin-Docs/blog/2021/06/05/using-visual-studio-code-with-opendtect/image-03.png"
         alt="OpendTect After Adding VS Code" width="90%"/> <figcaption>
            <p><strong>OpendTect After Adding VS Code</strong></p>
        </figcaption>
</figure>

Click the icon or use the &ldquo;Utilities|User Commands&rdquo; menu to start a Visual Studio Code instance.</p>
<h2 id="using-visual-studio-code">Using Visual Studio Code</h2>
<p>With these steps completed it should be possible to start VS Code from OpendTect and open a new blank Jupyter notebook by running
the Jupyter: Create Blank New Jupyter Notebook command from the VS Code Command Palette (Ctrl+Shift+P). This notebook will use
the Python environment selected in the OpendTect Python Settings dialog.

<figure class="img-centered">
    <img src="/WMPlugin-Docs/blog/2021/06/05/using-visual-studio-code-with-opendtect/image-04.png"
         alt="New Jupyter Notebook in VS Code" width="90%"/> <figcaption>
            <p><strong>New Jupyter Notebook in VS Code</strong></p>
        </figcaption>
</figure>
</p>
<p>To find out more about using VS Code with Jupyter Notebooks check out the documentation:</p>
<ul>
<li><a href="https://code.visualstudio.com/docs/python/jupyter-support">Working with Jupyter Notebooks in Visual Studio Code</a></li>
<li><a href="https://code.visualstudio.com/docs/python/jupyter-support-py">Working with the Python Interactive window</a></li>
</ul>

<figure class="img-centered">
    <img src="/WMPlugin-Docs/blog/2021/06/05/using-visual-studio-code-with-opendtect/image-01.png"
         alt="Exploring OpendTect Well Data in a VS Code Notebook" width="90%"/> <figcaption>
            <p><strong>Exploring OpendTect Well Data in a VS Code Notebook</strong></p>
        </figcaption>
</figure>
</div>





    
	
  
    
    
	
    


  

<div class="td-content" style="page-break-before: always">
    <h1 id="pg-48928b295051258867c91340ec92d098">GPU vs CPU Benchmarks for OpendTect Attribute Plugins</h1>
	
	<div class="td-byline mb-4">
		By <b>Wayne Mogg</b> |
        
		<time datetime="2019-01-07" class="text-muted">Monday, January 07, 2019</time>
        
	</div>
	<h2 id="summary">Summary</h2>
<p>The potential to offload calculations to the graphics processing unit (GPU) on modern graphics cards is a trending topic. I was curious if this could also apply to seismic attribute calculation in <a href="https://opendtect.org/">OpendTect</a>, so I implemented AVO polarization angle estimation as described by <a href="https://library.seg.org/doi/10.1190/1.1581037" title="AVO polarization and hodograms: AVO strength and polarization product. Patrice Nsoga Mahob and John P. Castagna, GEOPHYSICS, VOL. 68, NO. 3, MAY-JUNE 2003">Mahob and Castagna (2003)</a> using 3 different approaches:</p>
<ul>
<li>using loops for all the linear algebra and OpendTect&rsquo;s multi dimensional arrays (ArrayNDImpl) which I refer to as the Normal method;</li>
<li>using the <a href="http://eigen.tuxfamily.org/index.php?title=Main_Page">Eigen</a> linear algebra C++ template library (the Eigen method) and</li>
<li>using the <a href="https://arrayfire.com/">ArrayFire</a> linear algebra library for GPU&rsquo;s (the ArrayFire method).</li>
</ul>
<p>The first 2 options only use the central processing unit (CPU). ArrayFire also supports CPU calculation but for this review only the GPU capabilities were evaluated. In all cases benchmarks were run with and without OpendTect&rsquo;s multi-threaded processing support. Results are summarised in the following graph showing performance relative to the single threaded Normal method for a range of input data stepouts (higher performance numbers are better):</p>

<figure class="img-centered">
    <img src="/WMPlugin-Docs/blog/2019/01/07/gpu-vs-cpu-benchmarks-for-opendtect-attribute-plugins/19_01_07_1.png" width="90%"/> 
</figure>

<p>The primary observations are:</p>
<ul>
<li>Both Eigen and ArrayFire can be used relatively easily within OpendTect 6.4 attribute plugins;</li>
<li>OpendTect&rsquo;s multi-threaded processing support offers the most performance enhancement so developing the algorithm to enable multi-threading should be the first aim;</li>
<li>The Eigen library offers a noticeable performance enhancement of up to 20% (relative to explicit coding of the linear algebra) for single trace and low-medium stepout attributes. Algorithms can also be expressed in fewer lines of code that is simpler to understand.</li>
<li>The ArrayFire library makes it relatively easy to access the GPU compute power on the graphics card but the overhead of transferring data from the CPU to the GPU is significant and can result in poorer performance in some cases. The scale and/or compute complexity of the calculations will determine if there is any benefit to GPU calculations. In general this will require benchmarking of the particular algorithm.</li>
</ul>
<p>The code used in this evaluation is available in my <a href="https://github.com/waynegm/OpendTect-Plugins">OpendTect-Plugins</a> GitHub repository. Related details are described below.</p>
<h2 id="hardware-configuration">Hardware Configuration</h2>
<ul>
<li>Intel Core i5-3470 CPU @ 3.2Ghz</li>
<li>16GiB RAM</li>
<li>GeForce GTX1050 Ti with 4GiB RAM</li>
</ul>
<h2 id="sofware-configuration">Sofware Configuration</h2>
<p>Operating System:</p>
<ul>
<li>x86_64 GNU/Linux 4.2.0</li>
</ul>
<p>Software:</p>
<ul>
<li>OpendTect 6.4.2</li>
<li>gcc 8.2.1</li>
<li>Eigen 3.3.7</li>
<li>ArrayFire 3.6.1</li>
<li>CUDA Toolkit 10, Driver: 415.25, CUDA Compute 6.1</li>
</ul>
<h2 id="implementation">Implementation</h2>
<p>The attribute plugin source code is in my OpendTect-Plugins GitHub repository in the:</p>
<ul>
<li><a href="https://github.com/waynegm/OpendTect-Plugins/tree/master/plugins/NoRelease/AVOPolar">NoRelease/AVOPolar</a> and</li>
<li><a href="https://github.com/waynegm/OpendTect-Plugins/tree/master/plugins/NoRelease/uiAVOPolar">NoRelease/uiAVOPolar</a></li>
</ul>
<p>folders. The plugin user interface is shown in the following image:</p>

<figure class="img-centered">
    <img src="/WMPlugin-Docs/blog/2019/01/07/gpu-vs-cpu-benchmarks-for-opendtect-attribute-plugins/19_01_07_2.png"
         alt="Imports Section" width="90%"/> <figcaption>
            <p><strong>Imports Section</strong></p>
        </figcaption>
</figure>

<p>A comparison of the compute code for each method is shown below. All code assumes multi-trace intercept and gradient data in the 2D arrays with dimensions (<em>sz x ntraces</em>) named <em><strong>A</strong></em> and <em><strong>B</strong></em> respectively. Comparison of the code reveals both Eigen and ArrayFire allow significantly more concise and clearer coding of linear algebra calculations.</p>
<h3 id="normal-method">Normal Method</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#000">Array1DImpl</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#204a87;font-weight:bold">double</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">A2</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">sz</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000">Array1DImpl</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#204a87;font-weight:bold">double</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">B2</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">sz</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000">Array1DImpl</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#204a87;font-weight:bold">double</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">AB</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">sz</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">idx</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">idx</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">sz</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">idx</span><span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">double</span> <span style="color:#000">A2v</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0.0</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">double</span> <span style="color:#000">B2v</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0.0</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">double</span> <span style="color:#000">ABv</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0.0</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">trcidx</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">trcidx</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">ntraces</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">trcidx</span><span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">A2v</span> <span style="color:#ce5c00;font-weight:bold">+=</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">double</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000">A</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">get</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">trcidx</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">idx</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">double</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000">A</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">get</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">trcidx</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">idx</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">ABv</span> <span style="color:#ce5c00;font-weight:bold">+=</span> <span style="color:#000">A</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">get</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">trcidx</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">idx</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000">B</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">get</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">trcidx</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">idx</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">B2v</span> <span style="color:#ce5c00;font-weight:bold">+=</span> <span style="color:#000">B</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">get</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">trcidx</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">idx</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000">B</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">get</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">trcidx</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">idx</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">A2</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">set</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">idx</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">A2v</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">B2</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">set</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">idx</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">B2v</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">AB</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">set</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">idx</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">ABv</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000">Array1DImpl</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#204a87;font-weight:bold">double</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">A2win</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">sz</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000">windowedOps</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">sum</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#000">A2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">sampgateBG_</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">width</span><span style="color:#000;font-weight:bold">(),</span> <span style="color:#000">A2win</span> <span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000">Array1DImpl</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#204a87;font-weight:bold">double</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">B2win</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">sz</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000">windowedOps</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">sum</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#000">B2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">sampgateBG_</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">width</span><span style="color:#000;font-weight:bold">(),</span> <span style="color:#000">B2win</span> <span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000">Array1DImpl</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#204a87;font-weight:bold">double</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">ABwin</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">sz</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000">windowedOps</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">sum</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#000">AB</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">sampgateBG_</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">width</span><span style="color:#000;font-weight:bold">(),</span> <span style="color:#000">ABwin</span> <span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">idx</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">idx</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">sz</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">idx</span><span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">double</span> <span style="color:#000">ABv</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">ABwin</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">get</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">idx</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">double</span> <span style="color:#000">A2mB2</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">A2win</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">get</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">idx</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">B2win</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">get</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">idx</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">double</span> <span style="color:#000">d</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">sqrt</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">4.0</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">ABv</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">ABv</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">A2mB2</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">A2mB2</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">result</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">set</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">idx</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">atan2</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">2.0</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">ABv</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">A2mB2</span><span style="color:#ce5c00;font-weight:bold">+</span><span style="color:#000">d</span><span style="color:#000;font-weight:bold">)</span><span style="color:#ce5c00;font-weight:bold">/</span><span style="color:#000">M_PI</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#0000cf;font-weight:bold">180.0</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">idx</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">idx</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">nrsamples</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">idx</span><span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">setOutputValue</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">output</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">idx</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">z0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">result</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">idx</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#000">sampgateBG_</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">start</span><span style="color:#000;font-weight:bold">));</span>
</span></span></code></pre></div><h3 id="eigen-method">Eigen Method</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#000">Eigen</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">ArrayXd</span> <span style="color:#000">A2</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">A</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">square</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">rowwise</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">sum</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span><span style="color:#000">Eigen</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">ArrayXd</span> <span style="color:#000">B2</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">B</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">square</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">rowwise</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">sum</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span><span style="color:#000">Eigen</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">ArrayXd</span> <span style="color:#000">AB</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">A</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">B</span><span style="color:#000;font-weight:bold">).</span><span style="color:#000">rowwise</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">sum</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span><span style="color:#000">Eigen</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">ArrayXd</span> <span style="color:#000">A2win</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">sz</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000">windowedOpsEigen</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">sum</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#000">A2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">sampgateBG_</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">width</span><span style="color:#000;font-weight:bold">(),</span> <span style="color:#000">A2win</span> <span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000">Eigen</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">ArrayXd</span> <span style="color:#000">B2win</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">sz</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000">windowedOpsEigen</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">sum</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#000">B2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">sampgateBG_</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">width</span><span style="color:#000;font-weight:bold">(),</span> <span style="color:#000">B2win</span> <span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000">Eigen</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">ArrayXd</span> <span style="color:#000">ABwin</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">sz</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000">windowedOpsEigen</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">sum</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#000">AB</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">sampgateBG_</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">width</span><span style="color:#000;font-weight:bold">(),</span> <span style="color:#000">ABwin</span> <span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000">Eigen</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">ArrayXd</span> <span style="color:#000">A2mB2</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">A2win</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">B2win</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">Eigen</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">ArrayXd</span> <span style="color:#000">result</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">2.0</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">ABwin</span><span style="color:#ce5c00;font-weight:bold">/</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">A2mB2</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">4.0</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">ABwin</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">square</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">A2mB2</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">square</span><span style="color:#000;font-weight:bold">()).</span><span style="color:#000">sqrt</span><span style="color:#000;font-weight:bold">())).</span><span style="color:#000">atan</span><span style="color:#000;font-weight:bold">()</span><span style="color:#ce5c00;font-weight:bold">/</span><span style="color:#000">M_PI</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#0000cf;font-weight:bold">180.0</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">idx</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">idx</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">nrsamples</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">idx</span><span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">setOutputValue</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">output</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">idx</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">z0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">result</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">idx</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#000">sampgateBG_</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">start</span><span style="color:#000;font-weight:bold">));</span>
</span></span></code></pre></div><h3 id="arrayfire-method">ArrayFire Method</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#000">af</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">array</span> <span style="color:#000">A2</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">af</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">sum</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">A</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">A</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000">af</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">array</span> <span style="color:#000">B2</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">af</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">sum</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">B</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">B</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000">af</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">array</span> <span style="color:#000">AB</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">af</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">sum</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">A</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">B</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000">af</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">array</span> <span style="color:#000">kernel</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">af</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">constant</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">double</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#0000cf;font-weight:bold">1.0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">sampgateBG_</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">width</span><span style="color:#000;font-weight:bold">(),</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000">af</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">array</span> <span style="color:#000">A2win</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">af</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">convolve1</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">A2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">kernel</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000">af</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">array</span> <span style="color:#000">B2win</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">af</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">convolve1</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">B2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">kernel</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000">af</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">array</span> <span style="color:#000">ABwin</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">af</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">convolve1</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">AB</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">kernel</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000">af</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">array</span> <span style="color:#000">A2mB2</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">A2win</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">B2win</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">af</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">array</span> <span style="color:#000">result</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">af</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">atan2</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">2.0</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">ABwin</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">A2mB2</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">af</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">sqrt</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">4.0</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">ABwin</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">ABwin</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">A2mB2</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">A2mB2</span><span style="color:#000;font-weight:bold">))</span><span style="color:#ce5c00;font-weight:bold">/</span><span style="color:#000">M_PI</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#0000cf;font-weight:bold">180.0</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">double</span><span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000">resbuf</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">result</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">host</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#204a87;font-weight:bold">double</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">idx</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">idx</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">nrsamples</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">idx</span><span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">setOutputValue</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">output</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">idx</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">z0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">resbuf</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">idx</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#000">sampgateBG_</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">start</span><span style="color:#000;font-weight:bold">]);</span>
</span></span><span style="display:flex;"><span><span style="color:#000">af</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">freeHost</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">resbuf</span><span style="color:#000;font-weight:bold">);</span>
</span></span></code></pre></div><h2 id="method">Method</h2>
<ul>
<li>Attribute definitions were created for a range of stepouts, using a fixed window length, with/without multi-threading for each of the methods (Normal, Eigen and ArrayFire)</li>
<li>Input data volumes with ~100,000 traces were preloaded into RAM</li>
<li>The attributes were run using the OpendTect <strong>Processing|Create Seismic Output|Attributes|Single Attribute|</strong> menu item.</li>
<li>Elapsed time to evaluate the attribute were computed from the start and finish times reported in the Progress Viewer</li>
<li>Repeat runs conducted to verify consistency of the results.</li>
</ul>

</div>





    
	
  
    
    
	
    


  

<div class="td-content" style="page-break-before: always">
    <h1 id="pg-68d9691ed6354001f04dcafce131c82e">Python External Attribute Tips &amp; Tricks - Debugging</h1>
	
	<div class="td-byline mb-4">
		By <b>Wayne Mogg</b> |
        
		<time datetime="2018-06-08" class="text-muted">Friday, June 08, 2018</time>
        
	</div>
	<h2 id="introduction">Introduction</h2>
<p>Because the Python <a href="/WMPlugin-Docs/docs/plugins/externalattrib/">External Attribute</a> script is running in a process started by the OpendTect application most standard methods to examine the script as it runs, eg using the standard Python debugger <a href="https://docs.python.org/3/library/pdb.html">pdb</a>, are not available.</p>
<p>A solution is to use the <a href="https://github.com/romanvm/python-web-pdb">Web-PDB</a> Python module which allows the Python script to be debugged remotely in a web-browser.</p>
<h2 id="web-pdb-installation">Web-PDB Installation</h2>
<p><a href="https://github.com/romanvm/python-web-pdb">Web-PDB</a> is not included by default in most Python installations but it can be easily added using <em>pip</em>:</p>
<p><code>pip install web-pdb</code></p>
<h2 id="adding-web-pdb-to-a-script">Adding Web-PDB to a Script</h2>

<figure class="img-centered">
    <img src="/WMPlugin-Docs/blog/2018/06/08/python-external-attribute-tips-tricks-debugging/18_06_08_01.png" width="90%"/> 
</figure>

<p>Adding <a href="https://github.com/romanvm/python-web-pdb">Web-PDB</a> to a script is just a matter of importing the module as shown on line 5 and adding a call to  <code>web_pdb.set_trace()</code> as shown on line 19. The <code>web_pdb.set_trace()</code> call acts like a breakpoint and can be inserted as many times as required.</p>
<p>For simplicity it is best to disable multi-threaded processing (add a <em>Parallel: False</em> line to the <em>xa.params</em> object) while debugging.</p>
<h2 id="debugging-with-web-pdb">Debugging with Web-PDB</h2>

<figure class="img-centered">
    <img src="/WMPlugin-Docs/blog/2018/06/08/python-external-attribute-tips-tricks-debugging/18_06_08_02.png" width="90%"/> 
</figure>

<p>After adding <a href="https://github.com/romanvm/python-web-pdb">Web-PDB</a> to the [../plugins/ExternalAttrib] script it will run to the first breakpoint where execution will be suspended and a web-UI opened at the default port 5555. Pointing a web browser at <code>http://&lt;your  machine hostname or IP&gt;:5555</code>, eg <code>http://127.0.0.1:5555</code>, should show an interface for debugging as above.</p>
<p>The buttons provide control on the script execution, hover the mouse pointer over them to see tooltips for each. More complex <a href="https://docs.python.org/3/library/pdb.html">pdb</a> commands can be inserted in the entry at the bottom of the screen. Click the ? button for a list of useful <a href="https://docs.python.org/3/library/pdb.html">pdb</a> commands.</p>
<h2 id="web-pdb-and-multi-threaded-processing">Web-PDB and Multi-threaded Processing</h2>
<p>It is possible to use <a href="https://github.com/romanvm/python-web-pdb">Web-PDB</a> with a script that has multi-threaded processing enabled by replacing the initial <code>web_pdb.set_trace</code> call with:</p>
<p><code>web_pdb.set_trace( port=-1 )</code></p>
<p>This will cause each Python process to select a random port between 32768 and 65536. Operating System specific commands can then be used to determine the ports opened, eg:</p>
<ul>
<li>
<p>On Linux: <code>ss -lntu</code> in a console window.</p>
</li>
<li>
<p>On Windows: <code>netstat -an</code> in a command window.</p>
</li>
</ul>
<p>A web-UI will need to be opened for each port and each process will need to be stepped through all breakpoints for attribute execution to progress.</p>

</div>





    
	
  
    
    
	
    


  

<div class="td-content" style="page-break-before: always">
    <h1 id="pg-21f5150dff687604c8c9d21da0990e6c">Python External Attribute Tips &amp; Tricks - Logging</h1>
	
	<div class="td-byline mb-4">
		By <b>Wayne Mogg</b> |
        
		<time datetime="2018-06-06" class="text-muted">Wednesday, June 06, 2018</time>
        
	</div>
	<h2 id="introduction">Introduction</h2>
<p>It is possible to write information to the OpendTect logfile from inside a Python <a href="/WMPlugin-Docs/docs/plugins/externalattrib/">External Attribute</a> script.</p>
<p>The global variable <em>xa.logH</em> (assuming the extattrib module has been imported using <em>import extattrib as xa</em>) is a <a href="https://docs.python.org/3/library/logging.html">Python logger object</a>.</p>
<h2 id="an-example">An Example</h2>

<figure class="img-centered">
    <img src="/WMPlugin-Docs/blog/2018/06/06/python-external-attribute-tips-tricks-logging/18_06_06_01.png" width="90%"/> 
</figure>

<p>On line 18 the Python logger is modified by adjusting the severity level of messages that will appear in the log file. By default only CRITICAL, ERROR and WARNING messages will be written.</p>
<p>On line 22 a message is written to the logfile showing the full path to the Python interpreter executing the script. As this line is in the Compute Loop Initialisation section it is only written at each invocation of the script.</p>
<p>On line 32 a message is written that identifies the location, minimum and maximum of the trace being processed. As this line is in the Compute Loop a message is output for every trace processed.</p>
<h2 id="the-result">The Result</h2>

<figure class="img-centered">
    <img src="/WMPlugin-Docs/blog/2018/06/06/python-external-attribute-tips-tricks-logging/18_06_06_02.png" width="90%"/> 
</figure>


</div>





    
	
  
    
    
	
    


  

<div class="td-content" style="page-break-before: always">
    <h1 id="pg-df07e6c0c5aba733a97e8142e3fc5203">Anatomy of a Python External Attribute</h1>
	
	<div class="td-byline mb-4">
		By <b>Wayne Mogg</b> |
        
		<time datetime="2018-06-04" class="text-muted">Monday, June 04, 2018</time>
        
	</div>
	<h2 id="introduction">Introduction</h2>
<p>This article will review the structure of a simple Python <a href="/WMPlugin-Docs/docs/plugins/externalattrib/">External Attribute</a> script,
<a href="https://github.com/waynegm/OpendTect-External-Attributes/blob/master/Python_3/DipAndAzimuth/ex_dip.py">ex_dip.py</a>, which
converts inline and crossline dip to true dip and dip azimuth. It is an example of multi attribute, single trace input and
output. Some basic understanding of <a href="https://www.python.org/">Python</a> and <a href="http://www.numpy.org/">Numpy</a> is assumed.</p>
<p>Every Python attribute script has 5 sections.</p>
<h2 id="the-imports">The Imports</h2>

<figure class="img-centered">
    <img src="/WMPlugin-Docs/blog/2018/06/04/anatomy-of-a-python-external-attribute/18_06_04_01.png"
         alt="Imports Section" width="90%"/> <figcaption>
            <p><strong>Imports Section</strong></p>
        </figcaption>
</figure>

<p>This is where external modules/libraries required by the script are loaded. At a minimum the script must load:</p>
<ul>
<li>the Python sys and os modules</li>
<li>the Numpy module (the fundamental package for scientific computing with Python)</li>
<li>the external attribute module (extattrib.py)</li>
</ul>
<p>Generally sys, os and Numpy will be part of the Python installation. The extattrib module is part of the [wmscripts] package and its location is unknown to the Python installation unless we help out. The sys.path.insert call on line 11 provides this help by extending the default search path for Python modules to include the parent folder of the folder containing the script. This reflects the folder structure of the [wmscripts] package, so if you develop scripts outside this structure then you will need to change line 11 appropriately to append the location of extattrib.py to the module search path.</p>
<p>Of course if your script requires other Python modules (eg SciPy, Numba) then add the appropriate import statements in this section.</p>
<h2 id="the-parameters">The Parameters</h2>

<figure class="img-centered">
    <img src="/WMPlugin-Docs/blog/2018/06/04/anatomy-of-a-python-external-attribute/18_06_04_02.png"
         alt="UI Parameters" width="90%"/> <figcaption>
            <p><strong>UI Parameters</strong></p>
        </figcaption>
</figure>

<p>The xa.params global variable must be assigned a JSON object string describing the input parameters for the script. This JSON string is used by the plugin to build an input dialog box. This attribute is very simple specifying just 2 input volumes and 2 output volumes and a url for documentation. The plugin dynamically builds the following input dialog for this script:</p>

<figure class="img-centered">
    <img src="/WMPlugin-Docs/blog/2018/06/04/anatomy-of-a-python-external-attribute/18_06_04_06.png"
         alt="UI Appearance" width="90%"/> <figcaption>
            <p><strong>UI Appearance</strong></p>
        </figcaption>
</figure>

<p>A variety of other input elements can be specified to build more complex input dialogs. See the <a href="/WMPlugin-Docs/docs/plugins/externalattrib/#parameters-dictionary">Parameters Dictionary</a> section of the plugin documentation for full details or look at other scripts to see what is possible.</p>
<h2 id="the-compute-loop-initialisation">The Compute Loop Initialisation</h2>

<figure class="img-centered">
    <img src="/WMPlugin-Docs/blog/2018/06/04/anatomy-of-a-python-external-attribute/18_06_04_03.png"
         alt="Compute Initialisation" width="90%"/> <figcaption>
            <p><strong>Compute Initialisation</strong></p>
        </figcaption>
</figure>

<p>The doCompute function is where the attribute calculation occurs. The function is divided into 2 parts some initialisation and the &ldquo;while True:&rdquo; loop, discussed in the next section, where the calculations actually take place. Any code in this initialisation section will be executed just once when the attribute script is run and is a good place to calculate constants for use in the Compute Loop.</p>
<p>This particular script shows how information stored in the <a href="/WMPlugin-Docs/docs/plugins/externalattrib/#seismicinfo-block">SeismicInfo Block</a> can be used to calculate some constants purely as an example. This attribute is so simple that no initialisation is actually required.</p>
<h2 id="the-compute-loop">The Compute Loop</h2>

<figure class="img-centered">
    <img src="/WMPlugin-Docs/blog/2018/06/04/anatomy-of-a-python-external-attribute/18_06_04_04.png"
         alt="Compute Loop" width="90%"/> <figcaption>
            <p><strong>Compute Loop</strong></p>
        </figcaption>
</figure>

<p>This is where the attribute calculation takes place. The <em>xa.doInput()</em> and <em>xa.doOutput()</em> function calls control the input and output of seismic trace data between the script and OpendTect. Generally these should be the first and last statements within the compute loop.</p>
<p>Within the compute loop, some information about the current trace data such as the number of samples and the inline and crossline location are provided in the <a href="/WMPlugin-Docs/docs/plugins/externalattrib/#traceinfo-block">TraceInfo Block</a>. These can be accessed using constructs like <em>xa.TI[&rsquo;nrsamp&rsquo;]</em>. This information is not required for this particular script.</p>
<p>The global Numpy array <em>xa.Input</em> contains the input trace data. <em>xa.Input[&rsquo;name of input attribute&rsquo;]</em> returns a Numpy array with the trace data for the current compute location. The shape of this Numpy array depends on the traces stepouts required by the attribute. As this particular script uses just single trace input (inline and crossline step out of 0) the Numpy array has a shape of <em>(1,1,xa.TI[&rsquo;nrsamp&rsquo;])</em>. In the more general case of a multi-trace attribute the Numpy array shape would be <em>(xa.SI[&rsquo;nrinl&rsquo;], xa.SI[&rsquo;nrcrl&rsquo;], xa.TI[&rsquo;nrsamp&rsquo;])</em> and the input trace at the current location would be at the centre of the array, ie at index <em>[xa.SI[&rsquo;nrinl&rsquo;]//2, xa.SI[&rsquo;nrcrl&rsquo;]//2,&hellip;]</em>.</p>
<p>Attribute ouput must be put into the <em>xa.Output</em> global Numpy array before the <em>xa.doOutput()</em> function call. Each element (eg <em>xa.Output[&rsquo;name of output attribute&rsquo;]</em>) of the output array must have a shape of <em>(1,1,xa.TI[&rsquo;nrsamp&rsquo;])</em></p>
<h2 id="the-postamble">The Postamble</h2>

<figure class="img-centered">
    <img src="/WMPlugin-Docs/blog/2018/06/04/anatomy-of-a-python-external-attribute/18_06_04_05.png"
         alt="Wrapping up" width="90%"/> <figcaption>
            <p><strong>Wrapping up</strong></p>
        </figcaption>
</figure>

<p>This section is just boilerplate code that apprears in every attribute script which should never be changed.</p>

</div>





    
	
  



          </main>
        </div>
      </div>
      
<footer class="bg-dark py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="User mailing list" aria-label="User mailing list">
    <a class="text-white" target="_blank" rel="noopener" href="https://groups.google.com/a/opendtect.org/g/users" aria-label="User mailing list">
      <i class="fa fa-envelope"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="LinkedIn" aria-label="LinkedIn">
    <a class="text-white" target="_blank" rel="noopener" href="https://www.linkedin.com/in/waynemogg/" aria-label="LinkedIn">
      <i class="fab fa-linkedin-in"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-white" target="_blank" rel="noopener" href="https://github.com/waynegm/OpendTect-Plugins" aria-label="GitHub">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-12 col-sm-4 text-center py-2 order-sm-2">
        <small class="text-white">&copy; 2024 Wayne Mogg All Rights Reserved</small>
        
	
		<p class="mt-2"><a href="/WMPlugin-Docs/about/">About WMPlugins</a></p>
	
      </div>
    </div>
  </div>
</footer>


    </div>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
    integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
    crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js"
    integrity="sha512-UR25UO94eTnCVwjbXozyeVd6ZqpaAE9naiEUBK/A+QDbfSTQFhPGj5lOR6d8tsgbBk84Ggb5A3EkjsOgPRPcKA=="
    crossorigin="anonymous"></script>





<script src='/js/tabpane-persist.js'></script>






<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css"
    integrity="sha512-vJqxkZ+Sugf/6WRlpcxN01qVfX/29hF6qc33eHF1va3NgoV+U+wCi+uTAsQ10sDoGyBxHLdaHvGwDlV3yVYboA==" crossorigin="anonymous">

<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"
    integrity="sha512-5ufNcHqOYgilGEHPfuRIQ5B/vDS1M8+UC+DESZ5CwVgGTg+b2Ol/15rYL/GiCWJ/Sx8oVo0FPFok1dPk8U9INQ=="
    crossorigin="anonymous"></script>



<script defer src='https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js'
    integrity='sha512-ZA/RPrAo88DlwRnnoNVqKINnQNcWERzRK03PDaA4GIJiVZvGFIWQbdWCsUebMZfkWohnfngsDjXzU6PokO4jGw==' crossorigin='anonymous' 
    onload='renderMathInElement(document.body, null);'></script>















<script src="/WMPlugin-Docs/js/main.min.91798a335c881f1b6b805085ba4aa22d1dbd2b0b18d105d05189fa104ddae350.js" integrity="sha256-kXmKM1yIHxtrgFCFukqiLR29KwsY0QXQUYn6EE3a41A=" crossorigin="anonymous"></script>




<script src='/WMPlugin-Docs/js/juxtapose.js'></script>


  </body>
</html>
